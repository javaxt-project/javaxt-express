if(!javaxt)var javaxt={};if(!javaxt.dhtml)javaxt.dhtml={};
javaxt.dhtml.WebSite=function(content,config){this.className="javaxt.dhtml.WebSite";var me=this;var tabs;var carousel;var slideIndex;var defaultConfig={padding:20,background:"#ffffff",animationSteps:600};var fx=new javaxt.dhtml.Effects();var pageLoader=new javaxt.dhtml.PageLoader();var body=document.getElementsByTagName("body")[0];var debug=false;var init=function(){var clone={};merge(clone,config);merge(clone,defaultConfig);config=clone;tabs=config.tabs;var arr=[];for(var i=0;i<tabs.length;i++){var path=getPath(tabs[i].pathname);var dir=getDir(path);var div=tabs[i].getElementsByTagName("div")[0];arr.push({dir:dir,div:div})}tabs=arr;var links=document.getElementsByTagName("a");parseLinks(links);if(typeof SyntaxHighlighter!=="undefined"){SyntaxHighlighter.defaults["class-name"]="code-block";SyntaxHighlighter.defaults.toolbar=false;SyntaxHighlighter.defaults.gutter=false;highlight(content)}content.style.height=content.offsetHeight+"px";var currPage=document.createElement("div");currPage.style.height="100%";while(content.childNodes.length>0){var node=content.childNodes[0];content.removeChild(node);currPage.appendChild(node)}var nextPage=document.createElement("div");nextPage.style.height="100%";carousel=new javaxt.dhtml.Carousel(content,{items:[currPage,nextPage],drag:false,loop:true,padding:config.padding,animationSteps:config.animationSteps,transitionEffect:"easeInOutCubic",fx:fx});carousel.beforeChange=function(currPanel,nextPanel){updateContent(nextPanel);var currDir=getDir(getPath(window.location.pathname));var currTab=me.getTab(currDir);for(var i=0;i<tabs.length;i++){tabs[i].div.className=""}currTab.div.className="active";dispatchEvent("beforeunload")};carousel.onChange=function(currPanel,prevPanel){var resizeSteps=0;if(config.animationSteps>0){resizeSteps=100}if(body.scrollTop>50){setTimeout(function(){var animationSteps=1000;scrollTop(new Date().getTime(),animationSteps,animationSteps,function(){resize(currPanel,resizeSteps)})},250)}else{body.scrollTop=0;resize(currPanel,resizeSteps)}prevPanel.innerHTML="";dispatchEvent("load")};window.addEventListener("resize",function(e){var panels=carousel.getPanels();for(var i=0;i<panels.length;i++){if(panels[i].isVisible){resize(panels[i].div);return}}});dispatchEvent("resize");window.addEventListener("popstate",popstateListener);log(window.history.state);if(window.history.state==null){slideIndex=0;var panelInfo={index:slideIndex,title:document.title};history.replaceState(panelInfo,null,"")}else{slideIndex=window.history.state.index}log("slideIndex: "+slideIndex)};var popstateListener=function(e){var panel=e.state;log(panel);document.title=panel.title;var nextPage;var panels=carousel.getPanels();for(var i=0;i<panels.length;i++){if(!panels[i].isVisible){nextPage=panels[i].div;break}}var url=window.location;getHTML(url,function(html,title,inlineScripts){nextPage.innerHTML=html;loadInlineScripts(inlineScripts);if(slideIndex>=panel.index){carousel.back();slideIndex=panel.index}else{if(slideIndex<panel.index){carousel.next();slideIndex=panel.index}else{log(slideIndex+" vs "+panel.index)}}})};this.enablePopstateListener=function(){me.disablePopstateListener();window.addEventListener("popstate",popstateListener)};this.disablePopstateListener=function(){window.removeEventListener("popstate",popstateListener)};var resize=function(panel,animationSteps){var r1=_getRect(panel.parentNode);var r2=_getRect(panel);var h=r2.height+(r2.top-r1.top);if(h<100){return}if(animationSteps){_resize(parseInt(content.style.height),h,new Date().getTime(),animationSteps,animationSteps)}else{content.style.height=h+"px"}};var _resize=function(start,end,lastTick,timeLeft,animationSteps,callback){var curTick=new Date().getTime();var elapsedTicks=curTick-lastTick;if(timeLeft<=elapsedTicks){content.style.height=end+"px";if(callback){callback.apply(me,[])}return}timeLeft-=elapsedTicks;var d=start-end;var percentComplete=1-(timeLeft/animationSteps);var offset=Math.round(percentComplete*d);content.style.height=start-offset+"px";setTimeout(function(){_resize(start,end,curTick,timeLeft,animationSteps,callback)},33)};var scrollTop=function(lastTick,timeLeft,animationSteps,callback){var curTick=new Date().getTime();var elapsedTicks=curTick-lastTick;if(timeLeft<=elapsedTicks){body.scrollTop=0;if(callback){callback.apply(me,[])}return}timeLeft-=elapsedTicks;var start=body.scrollTop;var d=start;var percentComplete=1-(timeLeft/animationSteps);var offset=Math.round(percentComplete*d);body.scrollTop=start-offset;setTimeout(function(){scrollTop(curTick,timeLeft,animationSteps,callback)},33)};this.setContentHeight=function(h){content.style.height=h};var highlight=function(el){if(typeof SyntaxHighlighter!=="undefined"){var highlight=false;var nodes=el.getElementsByTagName("pre");for(var i=0;i<nodes.length;i++){var pre=nodes[i];if(pre.className==""){pre.className="brush: java;"}highlight=true}if(highlight){SyntaxHighlighter.highlight()}}};var parseLinks=function(links){for(var i=0;i<links.length;i++){if(links[i].hostname==window.location.hostname){var onclick=function(e){var url=this.href;if(window.location==url){e.preventDefault();return}var tmp=url.substring(url.indexOf(this.pathname)+this.pathname.length);if(tmp.indexOf("#")==0){e.preventDefault();return}var path=getPath(this.pathname);var dir=getDir(path);if(me.updateLink(url,path,dir)){e.preventDefault();getHTML(url,function(html,title,inlineScripts){load(html,title,url,dir,inlineScripts)})}};links[i].onclick=onclick}}};var load=function(html,title,url,dir,inlineScripts){var tab=me.getTab(dir);var currPath=getPath(window.location.pathname);var currDir=getDir(currPath);var currTab=me.getTab(currDir);document.title=title;history.pushState(null,title,url);var currPage,nextPage;var panels=carousel.getPanels();for(var i=0;i<panels.length;i++){var panel=panels[i];var el=panel.div;if(panel.isVisible){currPage=el}else{nextPage=el}}var slide=tab.dir!=currTab.dir;slide=true;if(!slide){currPage.innerHTML=html;updateContent(currPage)}else{nextPage.innerHTML=html;var a,b;for(var i=0;i<tabs.length;i++){var path=tabs[i].dir;if(path==currTab.dir){a=i}if(path==tab.dir){b=i}}log(a+" "+b);if(a==b){var path=getPath(window.location.pathname);if(path.indexOf(currPath)==0){b=1;a=0}else{log(currPath+" vs "+path)}}if(b>a){slideIndex++;carousel.next()}else{slideIndex--;carousel.back()}}loadInlineScripts(inlineScripts);var panelInfo={index:slideIndex,title:title};history.replaceState(panelInfo,title,url)};var loadInlineScripts=function(inlineScripts){for(var i=0;i<inlineScripts.length;i++){var script=inlineScripts[i].firstChild.nodeValue;eval(script)}};var dispatchEvent=function(name){var evt;try{evt=new Event(name)}catch(e){evt=document.createEvent("Event");evt.initEvent(name,false,false)}if(config.animationSteps>0){window.dispatchEvent(evt)}else{setTimeout(function(){window.dispatchEvent(evt)},50)}};me.getTabs=function(){return tabs};me.getTab=function(dir){for(var i=0;i<tabs.length;i++){if(tabs[i].dir==dir){return tabs[i]}}return null};this.updateLink=function(url,path,dir){if(dir=="downloads"||dir=="images"){var idx=path.lastIndexOf(".");if((path.length-idx)<5){return false}}return true};var updateContent=function(el){highlight(el);var links=el.getElementsByTagName("a");parseLinks(links)};var getPath=function(path){if(path==null){path=""}else{if(path.indexOf("/")==0){if(path.length>1){path=path.substring(1)}else{path=""}}}return path};var getDir=function(path){var dir=path.toLowerCase();var idx=dir.indexOf("/");if(idx>0){dir=dir.substring(0,idx)}return dir};var getHTML=function(url,callback){url+="";if(url.indexOf("?")==-1){url+="?"}else{url+="&"}url+="template=false";pageLoader.load(url,function(html,title,inlineScripts){var div=document.createElement("div");div.style.background=config.background;div.innerHTML=html;html=div.outerHTML;if(title==null||title.length==0){var h1=div.getElementsByTagName("h1");if(h1.length>0){title=h1[0].innerHTML}}div=null;if(callback){callback.apply(me,[html,title,inlineScripts])}})};var log=function(str){if(debug){console.log(str)}};var _getRect=function(el){if(el.getBoundingClientRect){return el.getBoundingClientRect()}else{var x=0;var y=0;var w=el.offsetWidth;var h=el.offsetHeight;function isNumber(n){return n===parseFloat(n)}var org=el;do{x+=el.offsetLeft-el.scrollLeft;y+=el.offsetTop-el.scrollTop}while(el=el.offsetParent);el=org;do{if(isNumber(el.scrollLeft)){x-=el.scrollLeft}if(isNumber(el.scrollTop)){y-=el.scrollTop}}while(el=el.parentNode);return{left:x,right:x+w,top:y,bottom:y+h,width:w,height:h}}};var merge=function(settings,defaults){for(var p in defaults){if(defaults.hasOwnProperty(p)&&typeof settings[p]!=="undefined"){if(p!=0){merge(settings[p],defaults[p])}}else{settings[p]=defaults[p]}}};init()};